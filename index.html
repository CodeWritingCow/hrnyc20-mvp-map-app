<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>NYC Homicide Map</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
    integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
    crossorigin=""/>

    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
   integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
   crossorigin=""></script>
 
    <style>
        #map {
            height: 600px;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        let nycMap = L.map('map').setView([40.75, -73.98], 11);

        L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png',
        {
            attribution: 'Moo',
            maxZoom: 17,
            minZoom: 1
        }).addTo(nycMap);

        let nypdData;

        fetch('https://data.cityofnewyork.us/resource/5ucz-vwe8.json?statistical_murder_flag=true')
            .then((res) => {
                return res.json();
            })
            .then((myJson) => {
                nypdData = JSON.stringify(myJson);
                myJson.forEach((crime) => {
                    L.marker([crime.latitude, crime.longitude])
                     .addTo(nycMap)
                     .bindPopup(`
                        <h3>${crime.occur_date}</h3>
                        <hr/>
                        <h5>${crime.occur_time}</h5>
                        <h5>${crime.boro}</h5>
                        <p>${crime.location_desc || ''}</p>
                        <h5>Victim</h5>
                        <p>Sex: ${getGender(crime.vic_sex)}</p>
                        <p>Age: ${crime.vic_age_group}</p>
                        <p>Race: ${crime.vic_race}</p>
                        <h5>Suspect</h5>
                        <p>Sex: ${getGender(crime.perp_sex)}</p>
                        <p>Age: ${crime.perp_age_group || 'Unknown'}</p>
                        <p>Race: ${crime.perp_race || 'Unknown'}</p>                        
                        `);                    
                })
                
            });
            let getGender = function (gender) {
                if (!gender) {
                    return 'Unknown';
                }
                if (gender === 'M') {
                    return 'Male';
                } 
                if (gender === 'F') {
                    return 'Female';
                }
            }
    </script>
    
</body>
</html>